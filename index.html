<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ—ãƒ¬ã‚¤ãƒ•ãƒ«è¨ºæ–­ - æ—¥å¸¸ã®å°ã•ãªå¹¸ã›ã‚’è¦‹ã¤ã‘ã‚ˆã†</title>
    <style>
        :root {
            --primary-color: #FF8A9B;
            --accent-yellow: #FFD93D;
            --accent-green: #6BCF7F;
            --text-color: #333;
            --background-gradient: linear-gradient(135deg, #FFE0E6 0%, #FFF5E6 50%, #E6F7E6 100%);
            --card-shadow: 0 8px 32px rgba(255, 138, 155, 0.2);
            --border-radius: 16px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: var(--background-gradient);
            min-height: 100vh;
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
            transform: translateY(20px);
            opacity: 0;
            animation: slideIn 0.6s ease forwards;
        }

        @keyframes slideIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        h1 {
            font-size: 2rem;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        h2 {
            font-size: 1.5rem;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .subtitle {
            text-align: center;
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 2rem;
            line-height: 1.7;
        }

        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            margin: 1rem 0;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            background: #e5798a;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 138, 155, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: var(--accent-green);
        }

        .btn-secondary:hover {
            background: #5bb86f;
        }

        .progress-container {
            margin-bottom: 2rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-yellow));
            border-radius: 4px;
            transition: width 0.4s ease;
            width: 0%;
        }

        .progress-text {
            text-align: center;
            font-size: 0.9rem;
            color: #666;
        }

        .question-container {
            margin-bottom: 2rem;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 500;
            text-align: center;
            margin-bottom: 2rem;
            line-height: 1.7;
            color: var(--text-color);
        }

        .answer-options {
            display: grid;
            gap: 12px;
            margin-bottom: 2rem;
        }

        .answer-option {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            border: 2px solid #e0e0e0 !important;
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            background: white !important;
            color: var(--text-color) !important;
            font-size: 1rem;
            text-align: center;
            font-weight: normal !important;
        }

        .answer-option:hover {
            border-color: var(--primary-color) !important;
            background: rgba(255, 138, 155, 0.1) !important;
            transform: translateY(-2px);
        }

        .answer-option.selected {
            border-color: var(--primary-color) !important;
            background: rgba(255, 138, 155, 0.2) !important;
            color: var(--primary-color) !important;
            font-weight: 600 !important;
        }

        .navigation {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn-nav {
            width: 200px;
            padding: 12px 24px;
            font-size: 1rem;
            margin: 0 auto;
        }

        .btn-prev {
            background: #666;
        }

        .btn-prev:hover {
            background: #555;
        }

        .results-container {
            text-align: center;
        }

        .total-score {
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 1rem 0;
            animation: countUp 1s ease;
        }

        @keyframes countUp {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        .score-label {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 2rem;
        }

        .factor-scores {
            margin: 2rem 0;
        }

        .factor-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            margin-bottom: 1rem;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            border: 1px solid rgba(255, 138, 155, 0.2);
        }

        .factor-name {
            font-weight: 600;
            flex: 1;
            text-align: left;
        }

        .factor-score {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-left: 1rem;
        }

        .factor-bar {
            flex: 2;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 0 1rem;
            overflow: hidden;
        }

        .factor-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-yellow));
            border-radius: 4px;
            transition: width 1s ease;
            width: 0%;
        }

        .level-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            margin: 1rem 0;
            font-size: 1.1rem;
        }

        .level-high {
            background: var(--accent-green);
            color: white;
        }

        .level-moderate-high {
            background: var(--accent-yellow);
            color: #333;
        }

        .level-moderate-low {
            background: #ffa500;
            color: white;
        }

        .level-low {
            background: #ff6b6b;
            color: white;
        }

        .comment-section {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
            border: 1px solid rgba(255, 138, 155, 0.2);
            text-align: left;
        }

        .comment-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 1rem;
            text-align: center;
        }

        .comment-text {
            line-height: 1.7;
            color: #444;
            font-size: 1rem;
        }

        .factor-comment {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }

        .factor-comment-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .actions {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .emoji {
            font-size: 1.5rem;
            margin-right: 0.5rem;
        }

        .form-section {
            margin: 2rem 0;
            text-align: left;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            background: white;
        }

        .form-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 138, 155, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            background: white;
            cursor: pointer;
        }

        .form-select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 138, 155, 0.1);
        }

        .required {
            color: var(--primary-color);
            margin-left: 2px;
        }

        .form-note {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
            line-height: 1.4;
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }

            .card {
                padding: 1.5rem;
            }

            h1 {
                font-size: 1.5rem;
            }

            .total-score {
                font-size: 2.5rem;
            }

            .actions {
                flex-direction: column;
            }

            .navigation {
                flex-direction: column;
            }
        }

        .error-message {
            background: #ffe6e6;
            color: #d8000c;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: center;
            border: 1px solid #ffcccc;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 20%, 40%, 60%, 80% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 4px;
            margin: 1rem 0;
        }

        .loading-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary-color);
            animation: bounce 1.4s ease-in-out infinite both;
        }

        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ã‚¦ã‚§ãƒ«ã‚«ãƒ ç”»é¢ -->
        <div class="screen active" id="welcome-screen">
            <div class="card">
                <h1>ğŸŒ¸ ãƒ—ãƒ¬ã‚¤ãƒ•ãƒ«è¨ºæ–­</h1>
                <p class="subtitle">
                    æ—¥å¸¸ã®å°ã•ãªå¹¸ã›ã‚’è¦‹ã¤ã‘ã‚ˆã†<br>
                    ã‚ãªãŸã®ãƒ—ãƒ¬ã‚¤ãƒ•ãƒ«ãƒã‚¹ï¼ˆéŠã³å¿ƒãƒ»æ¥½ã—ã•ã‚’è¦‹ã¤ã‘ã‚‹åŠ›ï¼‰ã‚’æ¸¬å®šã—ã¾ã™
                </p>
                <div style="text-align: center; margin: 2rem 0;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸˆ</div>
                    <p style="color: #666; font-size: 1rem;">
                        <strong>æ‰€è¦æ™‚é–“:</strong> 5-10åˆ†<br>
                        <strong>è³ªå•æ•°:</strong> 25é …ç›®<br>
                        <strong>ã‚ãªãŸã®æ—¥å¸¸ã§ã®éŠã³å¿ƒã‚’è¦‹ã¤ã‚ç›´ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ</strong>
                    </p>
                </div>

                <div class="form-section">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem; text-align: center;">ğŸ“ åŸºæœ¬æƒ…å ±ã‚’ãŠèã‹ã›ãã ã•ã„</h3>
                    
                    <div class="form-group">
                        <label class="form-label" for="name">ãŠåå‰<span class="required">*</span></label>
                        <input type="text" id="name" class="form-input" placeholder="ä¾‹ï¼šç”°ä¸­ èŠ±å­" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="age">å¹´é½¢<span class="required">*</span></label>
                        <input type="number" id="age" class="form-input" placeholder="ä¾‹ï¼š30" min="18" max="99" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="energy-level">ä»Šã®ã‚ãªãŸã®å…ƒæ°—åº¦ã¯ï¼Ÿ<span class="required">*</span></label>
                        <select id="energy-level" class="form-select" required>
                            <option value="" disabled selected>é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="5">5: ã¨ã¦ã‚‚é«˜ã„</option>
                            <option value="4">4: é«˜ã„</option>
                            <option value="3">3: æ™®é€š</option>
                            <option value="2">2: ä½ã„</option>
                            <option value="1">1: ã¨ã¦ã‚‚ä½ã„</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹<span class="required">*</span></label>
                        <input type="email" id="email" class="form-input" placeholder="ä¾‹ï¼šexample@mail.com" required>
                        <div class="form-note">
                            ğŸ“§ çµæœé€ä¿¡ã‚„ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ç ”ç©¶ã®ãŸã‚ã«ä½¿ç”¨ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚<br>
                            å€‹äººæƒ…å ±ã¯å³é‡ã«ç®¡ç†ã—ã€ç ”ç©¶ç›®çš„ä»¥å¤–ã«ã¯ä½¿ç”¨ã„ãŸã—ã¾ã›ã‚“ã€‚
                        </div>
                    </div>
                </div>

                <div id="form-error" class="error-message" style="display: none;">
                    ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ ğŸ˜Š
                </div>

                <button class="btn" onclick="startDiagnosis()">
                    <span class="emoji">âœ¨</span>è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹
                </button>
            </div>
        </div>

        <!-- è³ªå•ç”»é¢ -->
        <div class="screen" id="question-screen">
            <div class="card">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-text" id="progress-text">è³ªå• 1 / 25</div>
                </div>

                <div class="question-container">
                    <div class="question-text" id="question-text"></div>
                    <div class="answer-options" id="answer-options"></div>
                </div>

                <div id="error-message" class="error-message" style="display: none;">
                    å›ç­”ã‚’é¸æŠã—ã¦ãã ã•ã„ ğŸ˜Š
                </div>

                <div class="navigation">
                    <button class="btn btn-nav btn-prev" onclick="previousQuestion()" id="prev-btn" disabled>
                        ï¼‘ã¤å‰ã¸æˆ»ã‚‹
                    </button>
                </div>
            </div>
        </div>

        <!-- çµæœç”»é¢ -->
        <div class="screen" id="results-screen">
            <div class="card">
                <h2>ğŸ‰ è¨ºæ–­çµæœ</h2>
                
                <div class="results-container">
                    <div class="total-score" id="total-score">0.0</div>
                    <div class="score-label">ç·åˆãƒ—ãƒ¬ã‚¤ãƒ•ãƒ«ãƒã‚¹ã‚¹ã‚³ã‚¢</div>
                    <div class="level-badge" id="level-badge">è¨ˆç®—ä¸­...</div>
                </div>

                <div class="factor-scores" id="factor-scores">
                    <!-- å› å­åˆ¥ã‚¹ã‚³ã‚¢ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>

                <div class="comment-section" id="comment-section">
                    <div class="comment-title">âœ¨ ã‚ãªãŸã®ãƒ—ãƒ¬ã‚¤ãƒ•ãƒ«ãƒã‚¹ã«ã¤ã„ã¦</div>
                    <div class="comment-text" id="main-comment">
                        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                    </div>
                    <div id="factor-comments">
                        <!-- å› å­åˆ¥ã‚³ãƒ¡ãƒ³ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                    </div>
                </div>

                <div id="loading" class="loading" style="display: none;">
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                </div>

                <div class="actions">
                    <button class="btn btn-secondary" onclick="restartDiagnosis()">
                        <span class="emoji">ğŸ”„</span>ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è³ªå•ãƒ‡ãƒ¼ã‚¿
        const questions = [
            // å› å­1: æ—¥å¸¸ã®æ¥½ã—ã•ç™ºè¦‹ï¼ˆQ1-Q6ï¼‰
            { id: 1, text: "å®¶äº‹ã‚„è‚²å…ã®ä¸­ã§ã€ã¡ã‚‡ã£ã¨ã—ãŸæ¥½ã—ã¿ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ããŸ", factor: 1 },
            { id: 2, text: "ã„ã¤ã‚‚ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã®ä¸­ã«ã€æ–°é®®ã•ã‚„é¢ç™½ã•ã‚’æ„Ÿã˜ã‚‹ã“ã¨ãŒã‚ã£ãŸ", factor: 1 },
            { id: 3, text: "å¿™ã—ã„æ¯æ—¥ã§ã‚‚ã€å¿ƒã‹ã‚‰ã€Œæ¥½ã—ã„ã€ã¨æ„Ÿã˜ã‚‹ç¬é–“ãŒã‚ã£ãŸ", factor: 1 },
            { id: 4, text: "äº›ç´°ãªã“ã¨ã§ã‚‚ã€å–œã³ã‚’æ„Ÿã˜ã‚‹ã“ã¨ãŒã§ããŸ", factor: 1 },
            { id: 5, text: "å˜èª¿ã«æ€ãˆã‚‹æ—¥å¸¸ã®ä¸­ã§ã€ãƒ¯ã‚¯ãƒ¯ã‚¯ã™ã‚‹ã“ã¨ã‚’è¦‹ã¤ã‘ã‚‰ã‚ŒãŸ", factor: 1 },
            { id: 6, text: "ç–²ã‚Œã¦ã„ã¦ã‚‚ã€ä½•ã‹ã‚’æ¥½ã—ã„ã¨æ„Ÿã˜ã‚‹ã“ã¨ãŒã‚ã£ãŸ", factor: 1 },

            // å› å­2: è‡ªç”±æ„Ÿãƒ»è§£æ”¾æ„Ÿï¼ˆQ7-Q11ï¼‰
            { id: 7, text: "è‡ªåˆ†ã‚‰ã—ãã„ã‚‰ã‚Œã‚‹æ™‚é–“ã‚’æŒã¤ã“ã¨ãŒã§ããŸ", factor: 2 },
            { id: 8, text: "ã€Œæ¯è¦ªã€ã¨ã„ã†å½¹å‰²ã‹ã‚‰é›¢ã‚Œã¦ã€ä¸€äººã®äººé–“ã¨ã—ã¦è‡ªç”±ã‚’æ„Ÿã˜ã‚‹ã“ã¨ãŒã‚ã£ãŸ", factor: 2 },
            { id: 9, text: "ã‚„ã‚‰ãªã‘ã‚Œã°ãªã‚‰ãªã„ã“ã¨ã‚’å¿˜ã‚Œã¦ã€å¥½ããªã“ã¨ã«æ²¡é ­ã§ããŸ", factor: 2 },
            { id: 10, text: "å‘¨ã‚Šã®ç›®ã‚’æ°—ã«ã›ãšã€æ€ã„ã®ã¾ã¾ã«è¡Œå‹•ã§ãã‚‹ç¬é–“ãŒã‚ã£ãŸ", factor: 2 },
            { id: 11, text: "å¿ƒã®ä¸­ã§ã€Œè§£æ”¾ã•ã‚ŒãŸã€ã¨æ„Ÿã˜ã‚‹ã“ã¨ãŒã‚ã£ãŸ", factor: 2 },

            // å› å­3: å‰µé€ çš„ãƒ»è‡ªç™ºçš„æ´»å‹•ï¼ˆQ12-Q16ï¼‰
            { id: 12, text: "æ€ã„ã¤ã„ãŸã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ã€å®Ÿéš›ã«è©¦ã—ã¦ã¿ã‚‹ã“ã¨ãŒã‚ã£ãŸ", factor: 3 },
            { id: 13, text: "è¨ˆç”»ã«ã¯ãªã‹ã£ãŸã“ã¨ã‚’ã€ãã®å ´ã®ã²ã‚‰ã‚ãã§å®Ÿè¡Œã—ãŸ", factor: 3 },
            { id: 14, text: "æ–°ã—ã„ã‚„ã‚Šæ–¹ã‚„å·¥å¤«ã‚’æ€ã„ã¤ã„ã¦ã€è©¦ã—ã¦ã¿ãŸ", factor: 3 },
            { id: 15, text: "ã€Œã“ã‚“ãªã“ã¨ã‚’ã—ã¦ã¿ãŸã„ã€ã¨æ€ã£ãŸã“ã¨ã‚’ã€å®Ÿéš›ã«ã‚„ã£ã¦ã¿ãŸ", factor: 3 },
            { id: 16, text: "ã„ã¤ã‚‚ã¨ã¯é•ã†ã“ã¨ã«æŒ‘æˆ¦ã—ã¦ã¿ãŸã„ã¨ã„ã†æ°—æŒã¡ã«ãªã£ãŸ", factor: 3 },

            // å› å­4: å­ã©ã‚‚ã¨ã®ãƒ—ãƒ¬ã‚¤ãƒ•ãƒ«äº¤æµï¼ˆQ17-Q20ï¼‰
            { id: 17, text: "å­ã©ã‚‚ã¨ä¸€ç·’ã«ã€å¿ƒã‹ã‚‰æ¥½ã—ã„æ™‚é–“ã‚’éã”ã™ã“ã¨ãŒã§ããŸ", factor: 4 },
            { id: 18, text: "å­ã©ã‚‚ã¨éŠã‚“ã§ã„ã‚‹æ™‚ã«ã€è‡ªåˆ†ã‚‚ç«¥å¿ƒã«è¿”ã£ã¦æ¥½ã—ã‚ãŸ", factor: 4 },
            { id: 19, text: "å­ã©ã‚‚ã¨ã®ä½•æ°—ãªã„ä¼šè©±ã‚„è§¦ã‚Œåˆã„ã®ä¸­ã§ã€ç¬‘é¡”ã«ãªã‚‹ã“ã¨ãŒã‚ã£ãŸ", factor: 4 },
            { id: 20, text: "å­ã©ã‚‚ã¨ä¸€ç·’ã«æ–°ã—ã„ç™ºè¦‹ã‚„é©šãã‚’å…±æœ‰ã™ã‚‹ã“ã¨ãŒã‚ã£ãŸ", factor: 4 },

            // å› å­5: ç¤¾ä¼šçš„ã¤ãªãŒã‚Šã§ã®æ¥½ã—ã•ï¼ˆQ21-Q25ï¼‰
            { id: 21, text: "å‹äººã‚„çŸ¥ã‚Šåˆã„ã¨ã®ä¼šè©±ã§ã€å¿ƒã‹ã‚‰ç¬‘ã†ã“ã¨ãŒã‚ã£ãŸ", factor: 5 },
            { id: 22, text: "ä»–ã®äººã¨ä¸€ç·’ã«ã„ã‚‹æ™‚ã«ã€æ¥½ã—ã„æ°—æŒã¡ã‚’å…±æœ‰ã§ããŸ", factor: 5 },
            { id: 23, text: "è¿‘æ‰€ã®äººã¨ã®äº¤æµã®ä¸­ã§ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¦æ¥½ã—ã‚ãŸ", factor: 5 },
            { id: 24, text: "SNSã‚„ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§ã®ã‚„ã‚Šå–ã‚Šã§ã€æ¥½ã—ã„æ°—åˆ†ã«ãªã‚‹ã“ã¨ãŒã‚ã£ãŸ", factor: 5 },
            { id: 25, text: "èª°ã‹ã¨ä¸€ç·’ã«ä½•ã‹ã‚’ã™ã‚‹ä¸­ã§ã€ãƒ¯ã‚¯ãƒ¯ã‚¯ã™ã‚‹æ°—æŒã¡ã‚’æ„Ÿã˜ãŸ", factor: 5 }
        ];

        const answerOptions = [
            { value: 1, text: "ğŸ˜” ã¾ã£ãŸãå½“ã¦ã¯ã¾ã‚‰ãªã„" },
            { value: 2, text: "ğŸ˜ ã‚ã¾ã‚Šå½“ã¦ã¯ã¾ã‚‰ãªã„" },
            { value: 3, text: "ğŸ™‚ ã©ã¡ã‚‰ã§ã‚‚ãªã„" },
            { value: 4, text: "ğŸ˜Š ã‚„ã‚„å½“ã¦ã¯ã¾ã‚‹" },
            { value: 5, text: "ğŸ˜„ ã¨ã¦ã‚‚å½“ã¦ã¯ã¾ã‚‹" }
        ];

        const factorNames = [
            "æ—¥å¸¸ã®æ¥½ã—ã•ç™ºè¦‹",
            "è‡ªç”±æ„Ÿãƒ»è§£æ”¾æ„Ÿ", 
            "å‰µé€ çš„ãƒ»è‡ªç™ºçš„æ´»å‹•",
            "å­ã©ã‚‚ã¨ã®ãƒ—ãƒ¬ã‚¤ãƒ•ãƒ«äº¤æµ",
            "ç¤¾ä¼šçš„ã¤ãªãŒã‚Šã§ã®æ¥½ã—ã•"
        ];

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹
        const app = {
            currentQuestion: 0,
            answers: {},
            totalQuestions: questions.length,
            personalInfo: {}
        };

        // Google Apps Script URL
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzlSocwRIKNWmerdhhxPBMgBmadS4Dar2tMUSMTsIf_bO403htsWO28YNSRgFUcJ2eYxw/exec';

        // è¨ºæ–­é–‹å§‹
        function startDiagnosis() {
            // ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ãƒã‚§ãƒƒã‚¯
            if (!validatePersonalInfo()) {
                showFormError();
                return;
            }

            // å€‹äººæƒ…å ±ã‚’ä¿å­˜
            savePersonalInfo();
            hideFormError();
            
            showScreen('question-screen');
            displayQuestion(0);
        }

        // å€‹äººæƒ…å ±ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        function validatePersonalInfo() {
            const name = document.getElementById('name').value.trim();
            const age = document.getElementById('age').value;
            const energyLevel = document.getElementById('energy-level').value;
            const email = document.getElementById('email').value.trim();

            return name && age && energyLevel && email && validateEmail(email);
        }

        // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // å€‹äººæƒ…å ±ä¿å­˜
        function savePersonalInfo() {
            app.personalInfo = {
                name: document.getElementById('name').value.trim(),
                age: parseInt(document.getElementById('age').value),
                energyLevel: parseInt(document.getElementById('energy-level').value),
                email: document.getElementById('email').value.trim()
            };
            console.log('ãƒ‡ãƒãƒƒã‚°: ä¿å­˜ã•ã‚ŒãŸå€‹äººæƒ…å ±:', app.personalInfo);
        }

        // ãƒ•ã‚©ãƒ¼ãƒ ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
        function showFormError() {
            const errorMessage = document.getElementById('form-error');
            errorMessage.style.display = 'block';
            setTimeout(hideFormError, 3000);
        }

        // ãƒ•ã‚©ãƒ¼ãƒ ã‚¨ãƒ©ãƒ¼éè¡¨ç¤º
        function hideFormError() {
            document.getElementById('form-error').style.display = 'none';
        }

        // ç”»é¢è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // è³ªå•è¡¨ç¤º
        function displayQuestion(index) {
            const question = questions[index];
            document.getElementById('question-text').textContent = question.text;
            
            // é€²æ—æ›´æ–°
            const progress = ((index + 1) / app.totalQuestions) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `è³ªå• ${index + 1} / ${app.totalQuestions}`;
            
            // å›ç­”é¸æŠè‚¢è¡¨ç¤º
            const optionsContainer = document.getElementById('answer-options');
            optionsContainer.innerHTML = '';
            
            answerOptions.forEach(option => {
                const optionElement = document.createElement('div');
                optionElement.className = 'answer-option';
                optionElement.textContent = option.text;
                optionElement.dataset.value = option.value;
                
                // æ—¢å­˜ã®å›ç­”ãŒã‚ã‚Œã°é¸æŠçŠ¶æ…‹ã«ã™ã‚‹
                if (app.answers[question.id] === option.value) {
                    optionElement.classList.add('selected');
                }
                
                optionElement.addEventListener('click', (event) => {
                    // ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼šå…¨ã¦ã®é¸æŠçŠ¶æ…‹ã‚’ç¢ºå®Ÿã«ã‚¯ãƒªã‚¢
                    document.querySelectorAll('.answer-option').forEach(opt => {
                        opt.classList.remove('selected');
                        opt.style.backgroundColor = '';
                        opt.style.borderColor = '';
                        opt.style.color = '';
                    });
                    
                    selectAnswer(question.id, option.value, event.target);
                });
                
                optionsContainer.appendChild(optionElement);
            });
            
            // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            document.getElementById('prev-btn').disabled = index === 0;
            hideError();
        }

        // å›ç­”é¸æŠ
        function selectAnswer(questionId, value, targetElement) {
            app.answers[questionId] = value;
            
            // é¸æŠçŠ¶æ…‹ã®æ›´æ–°ï¼ˆæ—¢ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã§ã‚¯ãƒªã‚¢æ¸ˆã¿ï¼‰
            if (targetElement) {
                targetElement.classList.add('selected');
            }
            
            hideError();
            
            // 0.5ç§’å¾Œã«è‡ªå‹•ã§æ¬¡ã®è³ªå•ã¸
            setTimeout(() => {
                if (app.currentQuestion < app.totalQuestions - 1) {
                    app.currentQuestion++;
                    displayQuestion(app.currentQuestion);
                } else {
                    calculateAndShowResults();
                }
            }, 500);
        }


        // å‰ã®è³ªå•ã¸
        function previousQuestion() {
            if (app.currentQuestion > 0) {
                app.currentQuestion--;
                displayQuestion(app.currentQuestion);
            }
        }

        // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
        function showError() {
            const errorMessage = document.getElementById('error-message');
            errorMessage.style.display = 'block';
            setTimeout(hideError, 3000);
        }

        // ã‚¨ãƒ©ãƒ¼éè¡¨ç¤º
        function hideError() {
            document.getElementById('error-message').style.display = 'none';
        }

        // çµæœè¨ˆç®—ã¨è¡¨ç¤º
        function calculateAndShowResults() {
            showScreen('results-screen');
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            document.getElementById('loading').style.display = 'flex';
            
            setTimeout(() => {
                const results = calculateResults();
                displayResults(results);
                saveToGoogleSheets(results);
                document.getElementById('loading').style.display = 'none';
            }, 1000);
        }

        // ã‚¹ã‚³ã‚¢è¨ˆç®—
        function calculateResults() {
            const factorScores = [0, 0, 0, 0, 0]; // 5ã¤ã®å› å­
            const factorCounts = [0, 0, 0, 0, 0];
            
            questions.forEach(question => {
                const answer = app.answers[question.id];
                if (answer !== undefined) {
                    factorScores[question.factor - 1] += answer;
                    factorCounts[question.factor - 1]++;
                }
            });
            
            // å› å­åˆ¥å¹³å‡ã‚¹ã‚³ã‚¢è¨ˆç®—
            const factorAverages = factorScores.map((score, index) => 
                factorCounts[index] > 0 ? score / factorCounts[index] : 0
            );
            
            // ç·åˆã‚¹ã‚³ã‚¢è¨ˆç®—
            const totalScore = factorAverages.reduce((sum, avg) => sum + avg, 0) / factorAverages.length;
            
            return {
                totalScore: totalScore,
                factorScores: factorAverages,
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                answers: app.answers
            };
        }

        // çµæœè¡¨ç¤º
        function displayResults(results) {
            // ç·åˆã‚¹ã‚³ã‚¢è¡¨ç¤º
            const totalScoreElement = document.getElementById('total-score');
            animateNumber(totalScoreElement, 0, results.totalScore, 1500);
            
            // ãƒ¬ãƒ™ãƒ«åˆ¤å®š
            const level = getLevel(results.totalScore);
            const levelBadge = document.getElementById('level-badge');
            levelBadge.textContent = level.text + ' ' + level.emoji;
            levelBadge.className = 'level-badge ' + level.class;
            
            // å› å­åˆ¥ã‚¹ã‚³ã‚¢è¡¨ç¤º
            const factorContainer = document.getElementById('factor-scores');
            factorContainer.innerHTML = '';
            
            results.factorScores.forEach((score, index) => {
                const factorItem = document.createElement('div');
                factorItem.className = 'factor-item';
                factorItem.innerHTML = `
                    <div class="factor-name">${factorNames[index]}</div>
                    <div class="factor-bar">
                        <div class="factor-bar-fill" style="width: 0%"></div>
                    </div>
                    <div class="factor-score">${score.toFixed(1)}</div>
                `;
                factorContainer.appendChild(factorItem);
                
                // ãƒãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                setTimeout(() => {
                    const barFill = factorItem.querySelector('.factor-bar-fill');
                    barFill.style.width = (score / 5 * 100) + '%';
                }, 500 + index * 200);
            });

            // ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤º
            displayComments(results);
        }

        // ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤º
        function displayComments(results) {
            // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆ
            const mainComment = getMainComment(results.totalScore);
            document.getElementById('main-comment').innerHTML = mainComment;

            // å› å­åˆ¥ã‚³ãƒ¡ãƒ³ãƒˆ
            const factorCommentsContainer = document.getElementById('factor-comments');
            const factorComments = getFactorComments(results.factorScores);
            
            factorCommentsContainer.innerHTML = '';
            factorComments.forEach(comment => {
                if (comment.show) {
                    const commentDiv = document.createElement('div');
                    commentDiv.className = 'factor-comment';
                    commentDiv.innerHTML = `
                        <div class="factor-comment-title">${comment.title}</div>
                        <div>${comment.text}</div>
                    `;
                    factorCommentsContainer.appendChild(commentDiv);
                }
            });
        }

        // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
        function getMainComment(totalScore) {
            if (totalScore >= 4.0) {
                return `
                    <strong>ğŸŒŸ ã¨ã¦ã‚‚é«˜ã„ãƒ—ãƒ¬ã‚¤ãƒ•ãƒ«ãƒã‚¹</strong><br>
                    æ—¥å¸¸ç”Ÿæ´»ã®ä¸­ã§è±Šã‹ãªãƒ—ãƒ¬ã‚¤ãƒ•ãƒ«ä½“é¨“ãŒã§ãã¦ãŠã‚Šã€å¿ƒè±Šã‹ãªæ¯æ—¥ã‚’é€ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚å¿™ã—ã„æ¯æ—¥ã®ä¸­ã§ã‚‚ã€æ¥½ã—ã•ã‚„å–œã³ã‚’è¦‹ã¤ã‘ã‚‹åŠ›ãŒå‚™ã‚ã£ã¦ãŠã‚Šã€ãã‚Œã¯å¿ƒã®å¥åº·ã«ã¨ã£ã¦ã¨ã¦ã‚‚å¤§åˆ‡ãªè¦ç´ ã§ã™ã€‚<br><br>
                    ã“ã®ç´ æ™´ã‚‰ã—ã„çŠ¶æ…‹ã‚’ç¶­æŒã—ã¦ãã ã•ã„ã€‚ã‚ãªãŸã®å‰å‘ããªå§¿å‹¢ã¯ã€ãŠå­ã•ã‚“ã‚„å‘¨ã‚Šã®äººã«ã‚‚è‰¯ã„å½±éŸ¿ã‚’ä¸ãˆã¦ã„ã‚‹ã¯ãšã§ã™ã€‚å¼•ãç¶šãæ—¥å¸¸ã®å°ã•ãªå¹¸ã›ã‚’è¦‹ã¤ã‘ç¶šã‘ã¦ãã ã•ã„ã­ã€‚
                `;
            } else if (totalScore >= 3.0) {
                return `
                    <strong>âœ¨ è‰¯å¥½ãªãƒ—ãƒ¬ã‚¤ãƒ•ãƒ«ãƒã‚¹</strong><br>
                    ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸçŠ¶æ…‹ã§ã™ã€‚æ—¥å¸¸ã«æ¥½ã—ã•ã‚’è¦‹ã¤ã‘ã‚‹åŠ›ãŒã‚ã‚Šã€é©åº¦ãªãƒ—ãƒ¬ã‚¤ãƒ•ãƒ«ãƒã‚¹ã‚’ä¿ã¡ãªãŒã‚‰ç”Ÿæ´»ã—ã¦ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã™ã€‚å¿ƒã®çŠ¶æ…‹ã‚‚å®‰å®šã—ã¦ã„ã‚‹ã¨è¨€ãˆã‚‹ã§ã—ã‚‡ã†ã€‚<br><br>
                    æ™‚ã«ã¯ç–²ã‚Œã‚’æ„Ÿã˜ã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ãã‚“ãªæ™‚ã“ãå°ã•ãªæ¥½ã—ã¿ã«ç›®ã‚’å‘ã‘ã¦ã¿ã¦ãã ã•ã„ã€‚ã‚ãªãŸã«ã¯ãã®åŠ›ãŒã‚ã‚Šã¾ã™ã€‚
                `;
            } else if (totalScore >= 2.0) {
                return `
                    <strong>ğŸŒ± æˆé•·ã®ä½™åœ°ã‚ã‚Š</strong><br>
                    æ—¥ã€…ã®å¿™ã—ã•ã®ä¸­ã§ã€æ¥½ã—ã•ã‚’æ„Ÿã˜ã‚‹ä½™è£•ãŒå°‘ãªããªã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ãƒ—ãƒ¬ã‚¤ãƒ•ãƒ«ä½“é¨“ã‚’å¢—ã‚„ã™ã“ã¨ã§ã€ã‚ˆã‚Šå……å®Ÿã—ãŸæ—¥å¸¸ã‚’é€ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚ãã‚Œã¯ã¨ã¦ã‚‚è‡ªç„¶ãªã“ã¨ã§ã€å¤šãã®æ–¹ãŒçµŒé¨“ã™ã‚‹ã“ã¨ã§ã™ã€‚<br><br>
                    ä»Šã¯ãã‚Œã§ã‚‚å¤§ä¸ˆå¤«ã€‚ç„¡ç†ã‚’ã›ãšã€ã»ã‚“ã®å°‘ã—ã§ã‚‚ã€Œæ¥½ã—ã„ã€ã¨æ„Ÿã˜ã‚‰ã‚Œã‚‹ç¬é–“ã‚’å¤§åˆ‡ã«ã—ã¦ãã ã•ã„ã€‚å°ã•ãªä¸€æ­©ã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ã§ã€ãã£ã¨å¿ƒã«ä½™è£•ãŒç”Ÿã¾ã‚Œã¦ãã¾ã™ã€‚
                `;
            } else {
                return `
                    <strong>ğŸ’ª æ”¹å–„ã®ãƒãƒ£ãƒ³ã‚¹</strong><br>
                    æ—¥å¸¸ã®ä¸­ã§æ¥½ã—ã•ã‚’æ„Ÿã˜ã‚‹ã“ã¨ãŒé›£ã—ã„çŠ¶æ³ã«ã‚ã‚‹ã‚ˆã†ã§ã™ã€‚æ—¥å¸¸ã«æ¥½ã—ã•ã‚’å–ã‚Šå…¥ã‚Œã‚‹ã“ã¨ã§ã€ç”Ÿæ´»ã®è³ªã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã‚Œã¯æ±ºã—ã¦ã‚ãªãŸãŒæ‚ªã„ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æ™‚ã«ã¯ãã‚“ãªæ™‚æœŸã‚‚ã‚ã‚‹ã‚‚ã®ã§ã™ã€‚<br><br>
                    ã©ã‚“ãªã«å°ã•ãªã“ã¨ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚ä¸€æ—¥ã«ä¸€ã¤ã€ã€Œã¡ã‚‡ã£ã¨ã„ã„ãªã€ã¨æ€ãˆã‚‹ã“ã¨ã‚’è¦‹ã¤ã‘ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿã‚ãªãŸã¯ä¸€äººã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚†ã£ãã‚Šã¨ã€è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã§å¤§ä¸ˆå¤«ã§ã™ã€‚
                `;
            }
        }

        // å› å­åˆ¥ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
        function getFactorComments(factorScores) {
            const comments = [];

            // æœ€ã‚‚é«˜ã„ã‚¹ã‚³ã‚¢ã®å› å­
            const maxScore = Math.max(...factorScores);
            const maxIndex = factorScores.indexOf(maxScore);
            
            if (maxScore >= 3.5) {
                const strengthTexts = [
                    "æ—¥å¸¸ã®ä¸­ã§æ¥½ã—ã•ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã¨ã¦ã‚‚ä¸Šæ‰‹ã§ã™ã€‚ã“ã®æ„Ÿè¦šã‚’å¤§åˆ‡ã«ã—ç¶šã‘ã¦ãã ã•ã„ã€‚æœã®ã‚³ãƒ¼ãƒ’ãƒ¼ã‚¿ã‚¤ãƒ ã‚„æ–™ç†ã®æ™‚é–“ãªã©ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã®ä¸­ã«å–œã³ã‚’è¦‹å‡ºã™åŠ›ã¯ç´ æ™´ã‚‰ã—ã„æ‰èƒ½ã§ã™ã€‚",
                    "è‡ªåˆ†ã‚‰ã—ã•ã‚’å¤§åˆ‡ã«ã§ãã¦ã„ã¦ç´ æ™´ã‚‰ã—ã„ã§ã™ã€‚ãã®è‡ªç”±ãªå¿ƒã‚’ä¿ã¡ç¶šã‘ã¦ãã ã•ã„ã­ã€‚ã€Œæ¯è¦ªã€ã¨ã„ã†å½¹å‰²ã‹ã‚‰é›¢ã‚Œã¦ã€ä¸€äººã®äººé–“ã¨ã—ã¦è‡ªåˆ†ã‚’å¤§åˆ‡ã«ã§ãã¦ã„ã‚‹ã®ã¯è²´é‡ãªæ™‚é–“ã§ã™ã€‚",
                    "æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã™ã‚‹æ°—æŒã¡ãŒè±Šã‹ã§ã™ã€‚ãã®å‰µé€ æ€§ã¯ã‚ãªãŸã®å¤§ããªå¼·ã¿ã§ã™ã€‚æ€ã„ã¤ã„ãŸã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å®Ÿè¡Œã«ç§»ã™è¡Œå‹•åŠ›ã¯ã€ç”Ÿæ´»ã«æ´»åŠ›ã‚’ã‚‚ãŸã‚‰ã—ã¦ã„ã¾ã™ã€‚",
                    "ãŠå­ã•ã‚“ã¨ã®æ™‚é–“ã‚’å¿ƒã‹ã‚‰æ¥½ã—ã‚ã¦ã„ã‚‹ã®ã¯æœ¬å½“ã«ç´ æ•µãªã“ã¨ã§ã™ã€‚å­ã©ã‚‚ã¨ä¸€ç·’ã«ç«¥å¿ƒã«è¿”ã£ã¦æ¥½ã—ã‚ã‚‹æ„Ÿæ€§ã¯ã€è¦ªå­ã®çµ†ã‚’æ·±ã‚ã‚‹å¤§åˆ‡ãªè¦ç´ ã§ã™ã€‚",
                    "äººã¨ã®ç¹‹ãŒã‚Šã®ä¸­ã§å–œã³ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œã¦ã„ã‚‹ã®ã¯å¿ƒã®è±Šã‹ã•ã®è¡¨ã‚Œã§ã™ã€‚å‹äººã‚„çŸ¥ã‚Šåˆã„ã¨ã®äº¤æµã§å¿ƒã‹ã‚‰ç¬‘ãˆã‚‹ã“ã¨ã¯ã€ç²¾ç¥çš„ãªæ”¯ãˆã«ãªã£ã¦ã„ã¾ã™ã€‚"
                ];
                
                comments.push({
                    title: `ğŸ’ª ã‚ãªãŸã®å¼·ã¿ï¼š${factorNames[maxIndex]}`,
                    text: strengthTexts[maxIndex],
                    show: true
                });
            }

            // å®Ÿè·µçš„ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³
            const practicalAdvice = getPracticalAdvice(factorScores);
            if (practicalAdvice.length > 0) {
                comments.push({
                    title: "ğŸ¯ ä»Šã™ãã§ãã‚‹ã“ã¨",
                    text: `<ul style="margin: 0.5rem 0; padding-left: 1.2rem;">${practicalAdvice.map(advice => `<li style="margin-bottom: 0.5rem;">${advice}</li>`).join('')}</ul>`,
                    show: true
                });
            }

            // æœ€ã‚‚ä½ã„ã‚¹ã‚³ã‚¢ã®å› å­ï¼ˆ2.5æœªæº€ã®å ´åˆï¼‰
            const minScore = Math.min(...factorScores);
            const minIndex = factorScores.indexOf(minScore);
            
            if (minScore < 2.5) {
                const improvementTexts = [
                    "å¿™ã—ã„æ¯æ—¥ã®ä¸­ã§ã‚‚ã€ã»ã‚“ã®å°‘ã—ã®æ¥½ã—ã¿ã‚’æ„è­˜ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿæœã®ã‚³ãƒ¼ãƒ’ãƒ¼ã‚¿ã‚¤ãƒ ã«å¥½ããªéŸ³æ¥½ã‚’ã‹ã‘ãŸã‚Šã€ãŠæ°—ã«å…¥ã‚Šã®é¦™ã‚Šã®ãƒãƒ³ãƒ‰ã‚¯ãƒªãƒ¼ãƒ ã‚’ä½¿ã£ãŸã‚Šã€5åˆ†ã§ã§ãã‚‹å°ã•ãªæ¥½ã—ã¿ã‹ã‚‰å§‹ã‚ã¦ã¿ã¦ãã ã•ã„ã€‚",
                    "æ™‚ã«ã¯ã€Œæ¯è¦ªã®ç§ã€ã§ã¯ãªãã€Œä¸€äººã®ç§ã€ã®æ™‚é–“ã‚’ä½œã‚‹ã“ã¨ã‚‚å¤§åˆ‡ã§ã™ã€‚å…¥æµ´æ™‚é–“ã‚’å°‘ã—é•·ã‚ã«ã¨ã£ã¦ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ãŸã‚Šã€å­ã©ã‚‚ãŒå¯ãŸå¾Œã®çŸ­æ™‚é–“ã§ã‚‚è‡ªåˆ†ã ã‘ã®æ™‚é–“ã‚’æ„è­˜çš„ã«æŒã£ã¦ã¿ã¦ãã ã•ã„ã­ã€‚",
                    "æ–°ã—ã„ã“ã¨ã‚’å§‹ã‚ã‚‹ã®ã¯å‹‡æ°—ãŒã„ã‚Šã¾ã™ãŒã€å°ã•ãªå¤‰åŒ–ã‹ã‚‰è©¦ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿæ–™ç†ã§æ–°ã—ã„èª¿å‘³æ–™ã‚„ç››ã‚Šä»˜ã‘ã‚’è©¦ã—ãŸã‚Šã€ã„ã¤ã‚‚ã¨é•ã†é“ã‚’æ­©ã„ã¦ã¿ãŸã‚Šã€èº«è¿‘ãªã¨ã“ã‚ã‹ã‚‰å§‹ã‚ã‚‰ã‚Œã¾ã™ã€‚",
                    "ãŠå­ã•ã‚“ã¨ã®æ™‚é–“ã«å°‘ã—ç–²ã‚Œã‚’æ„Ÿã˜ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚å®Œç’§ã§ãªãã¦ã‚‚å¤§ä¸ˆå¤«ã€‚æ‰‹éŠã³ã‚„æ­Œã‚’ä¸€ç·’ã«æ¥½ã—ã‚“ã ã‚Šã€ãŠçµµæãã‚’ã—ãŸã‚Šã€ç°¡å˜ãªã“ã¨ã‹ã‚‰ä¸€ç·’ã«æ¥½ã—ã‚“ã§ã¿ã¦ãã ã•ã„ã€‚ä¸€ç·’ã«ã„ã‚‹ã ã‘ã§ååˆ†æ„›æƒ…ã¯ä¼ã‚ã£ã¦ã„ã¾ã™ã€‚",
                    "ä»Šã¯äººã¨ã®ç¹‹ãŒã‚Šã«ç–²ã‚Œã‚’æ„Ÿã˜ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ç„¡ç†ã‚’ã›ãšã€SNSã§å…±æ„Ÿã§ãã‚‹æŠ•ç¨¿ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚„ã„ã„ã­ã‚’ã—ãŸã‚Šã€è¿‘æ‰€ã®äººã¨ã®æŒ¨æ‹¶ã‹ã‚‰å§‹ã‚ã¦ã¿ã¦ãã ã•ã„ã€‚å°ã•ãªç¹‹ãŒã‚Šã‹ã‚‰å§‹ã‚ã¦å¤§ä¸ˆå¤«ã§ã™ã€‚"
                ];
                
                comments.push({
                    title: `ğŸŒ± æˆé•·ã®ãƒ’ãƒ³ãƒˆï¼š${factorNames[minIndex]}`,
                    text: improvementTexts[minIndex],
                    show: true
                });
            }

            return comments;
        }

        // å®Ÿè·µçš„ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆ
        function getPracticalAdvice(factorScores) {
            const advice = [];
            
            if (factorScores[0] < 3.0) { // æ—¥å¸¸ã®æ¥½ã—ã•ç™ºè¦‹
                advice.push("æœã®ã‚³ãƒ¼ãƒ’ãƒ¼ã‚¿ã‚¤ãƒ ã«å¥½ããªéŸ³æ¥½ã‚’ã‹ã‘ã¦ã€5åˆ†ã ã‘è‡ªåˆ†æ™‚é–“ã‚’ä½œã‚‹");
            }
            if (factorScores[1] < 3.0) { // è‡ªç”±æ„Ÿãƒ»è§£æ”¾æ„Ÿ
                advice.push("å…¥æµ´æ™‚é–“ã‚’å°‘ã—é•·ã‚ã«ã¨ã£ã¦ã€ãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ ã«ã™ã‚‹");
            }
            if (factorScores[2] < 3.0) { // å‰µé€ çš„ãƒ»è‡ªç™ºçš„æ´»å‹•
                advice.push("æ–™ç†ã§æ–°ã—ã„èª¿å‘³æ–™ã‚„ç››ã‚Šä»˜ã‘ã‚’è©¦ã—ã¦ã¿ã‚‹");
            }
            if (factorScores[3] < 3.0) { // å­ã©ã‚‚ã¨ã®ãƒ—ãƒ¬ã‚¤ãƒ•ãƒ«äº¤æµ
                advice.push("å­ã©ã‚‚ã¨ä¸€ç·’ã«æ‰‹éŠã³ã‚„æ­Œã‚’æ¥½ã—ã‚€æ™‚é–“ã‚’ä½œã‚‹");
            }
            if (factorScores[4] < 3.0) { // ç¤¾ä¼šçš„ã¤ãªãŒã‚Šã§ã®æ¥½ã—ã•
                advice.push("SNSã§å…±æ„Ÿã§ãã‚‹æŠ•ç¨¿ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚„ã„ã„ã­ã‚’ã™ã‚‹");
            }
            
            // å…±é€šã‚¢ãƒ‰ãƒã‚¤ã‚¹
            advice.push("å®Œç’§ã‚’æ±‚ã‚ã™ããšã€å°ã•ãªæ¥½ã—ã¿ã‚’å¤§åˆ‡ã«ã™ã‚‹");
            advice.push("ç–²ã‚ŒãŸæ™‚ã¯ç„¡ç†ã‚’ã›ãšã€è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã‚’å¤§åˆ‡ã«ã™ã‚‹");
            
            return advice.slice(0, 5); // æœ€å¤§5ã¤ã¾ã§è¡¨ç¤º
        }

        // æ•°å€¤ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        function animateNumber(element, start, end, duration) {
            const startTime = performance.now();
            
            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const current = start + (end - start) * progress;
                
                element.textContent = current.toFixed(1);
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            requestAnimationFrame(update);
        }

        // ãƒ¬ãƒ™ãƒ«åˆ¤å®š
        function getLevel(score) {
            if (score >= 4.0) {
                return { text: "é«˜ã„", emoji: "ğŸŒŸ", class: "level-high" };
            } else if (score >= 3.0) {
                return { text: "ã‚„ã‚„é«˜ã„", emoji: "ğŸ˜Š", class: "level-moderate-high" };
            } else if (score >= 2.0) {
                return { text: "ã‚„ã‚„ä½ã„", emoji: "ğŸ¤”", class: "level-moderate-low" };
            } else {
                return { text: "ä½ã„", emoji: "ğŸ˜”", class: "level-low" };
            }
        }

        // Google Apps Scriptã«ãƒ‡ãƒ¼ã‚¿é€ä¿¡
        async function saveToGoogleSheets(results) {
            try {
                const data = {
                    timestamp: results.timestamp,
                    name: app.personalInfo.name,
                    age: app.personalInfo.age,
                    email: app.personalInfo.email,
                    energyLevel: app.personalInfo.energyLevel,
                    totalScore: results.totalScore.toFixed(2),
                    factor1: results.factorScores[0].toFixed(2),
                    factor2: results.factorScores[1].toFixed(2),
                    factor3: results.factorScores[2].toFixed(2),
                    factor4: results.factorScores[3].toFixed(2),
                    factor5: results.factorScores[4].toFixed(2),
                    userAgent: results.userAgent,
                    answers: results.answers
                };

                const formData = new FormData();
                formData.append('data', JSON.stringify(data));

                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('ãƒ‡ãƒ¼ã‚¿é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }

                console.log('ãƒ‡ãƒ¼ã‚¿é€ä¿¡å®Œäº†');
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
                // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’æãªã‚ãªã„ã‚ˆã†ã«ã€
                // ã‚µã‚¤ãƒ¬ãƒ³ãƒˆã«å‡¦ç†ã™ã‚‹
            }
        }


        // è¨ºæ–­å†é–‹å§‹
        function restartDiagnosis() {
            app.currentQuestion = 0;
            app.answers = {};
            app.personalInfo = {};
            
            // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('name').value = '';
            document.getElementById('age').value = '';
            document.getElementById('energy-level').value = '';
            document.getElementById('email').value = '';
            hideFormError();
            
            showScreen('welcome-screen');
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ãƒ—ãƒ¬ã‚¤ãƒ•ãƒ«è¨ºæ–­ã‚¢ãƒ—ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
        });
    </script>
</body>
</html>
